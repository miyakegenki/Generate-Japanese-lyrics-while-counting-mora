# 日本語歌詞生成スクリプト（モーラ[音]の数を数えながら）

このプロジェクトは、Google Gemini と Microsoft Copilot の支援を受けて開発された、日本語歌詞生成スクリプトです。

Open AI Chat GPTもGoogle GeminiもAnthropic Claudeも日本語の歌詞生成は出来ます。

ただ、日本語の音の数、

- 例：「君の瞳に」
  - 読み：きみのひとみに
  - モーラ分割：き・み・の・ひ・と・み・に（7モーラ）

などと指定して、日本語の歌詞生成することは2025年8月9日(土曜日)現在困難です。

※「音数」は日本語のモーラ数を指します（例：「きみのひとみに」は7モーラ）。文字数とは異なるため注意してください。

やろうとしても各社ともかなり苦手で、音数（モーラ数）を守ることが難しいです。

そこで、このスクリプトは、以下のような流れでモーラ数制約付きの歌詞生成を実現します：

1. 最初にGoogle Gemini 1.5 flash(無料で利用できる範囲)で歌詞を生成

2. Google Gemini 1.5 flashではモーラ数を数えるのが苦手なので、Google Gemini 1.5 flashで生成した歌詞をこのPythonスクリプトで分析

3. 日本語のモーラ数（音数）が指定した音数（例：『7音+7音+8音+8音』、あくまでも例です。変更可能）になっているか確認

4. なっていない部分があれば、Google Gemini 1.5 flashに返し、再度モーラ数（音数）に合うものを考え直して貰う。ただしGoogle Gemini 1.5 flashは無料で利用できる範囲で行う。

5. Google Gemini 1.5 flashから考え直した歌詞が返ってきたら、またこのPythonスクリプトで分析。日本語のモーラ数（音数）が指定した『7音+7音+8音+8音』（あくまで例です。変更可能）になっているか確認。

6. これを繰り返していくPythonスクリプトです。

7. 既定では10回まで繰り返していきます。（無料枠向けに控えめ）

## 特徴
- モーラ数（音数）制約付きの歌詞生成
- 違反行の自動検出と修復ループ
- fugashi + unidic-lite による形態素解析

## 必要なもの
- `GEMINI_API_KEY`（Google Gemini 1.5 flashを利用するので。Google Ai Studioから入手可能です）
- Python実行環境（Python 3.10で動作確認）
- fugashi（内部でMeCabを使用。モーラ数の解析に使用）
- unidic-lite（日本語辞書。形態素解析の精度向上に使用）
- cutlet（日本語のふりがなをローマ字に変換。Geminiへの入力整形に使用。MeCab単体では読み仮名が不安定なため、cutletを併用することでより確実な読み仮名取得を実現）

## 設定
- **APIキーの設定方法**：
  - Windowsの検索バーで「環境変数を編集」と入力し、「システム環境変数の編集」を選択します。
  - 「システムのプロパティ」ウィンドウが表示されたら、「環境変数」ボタンをクリックします。
  - 「環境変数」ウィンドウの上半分、「ユーザーの環境変数」セクションにある「新規」ボタンをクリックします。
  - 「新しいユーザー変数」ウィンドウで、以下の情報を入力します。
    - **変数名**: GEMINI_API_KEY
    - **変数値**: Google Ai Studioから入手したAPIキー
  - 「OK」をクリックしてすべてのウィンドウを閉じます。
  - 注意点：環境変数を設定した後は、PowerShellやVS Codeなど、APIキーを使いたいアプリケーションを一度再起動する必要があります。再起動することで、新しい環境変数が読み込まれます。
　
- **題材（THEME）**
  このPythonスクリプトでは例として「THEME = "恋愛"」にしています。任意でここを書き換えて実行してください。

- **雰囲気(MOOD)**
  このPythonスクリプトでは例として「MOOD = "少し悲しい感じ"」にしています。任意でここを書き換えて実行してください。

- **音の数（モーラの数）**
  このPythonスクリプトでは例として「MORA_STRUCTURE = [7, 7, 8, 8]」にしています。これは1番が「7文字+7文字+8文字+8文字」になるように。という設定です。（正確には音数が「7音+7音+8音+8音」、もっと正確に言えばモーラ数が「7モーラ+7モーラ+8モーラ+8モーラ」）になるように。という設定です。任意でここを書き換えて実行してください。

- **何番まで歌詞を書くか**
  このPythonスクリプトでは例として「VERSES = 4」にしています。これは4番まで歌詞を書いて、という設定です。任意でここを書き換えて実行してください。

## インストール

以下のコマンドで必要なライブラリをインストールしてください：

```bash
pip install -r requirements.txt
```

## 使用方法

```bash
python generate_lyrics_ver(最新版).py
```

## 注意事項
- APIキーの漏洩防止にご注意ください  
- Google Gemini の無料枠にはリクエスト回数やトークン長の制限があります。頻繁な利用や長文生成には注意してください。

## 作者情報
三宅元貴（GitHub: [miyakegenki](https://github.com/miyakegenki)）

## ライセンス
このプロジェクトは MIT ライセンスのもとで公開されています。  
商用・非商用問わず、自由に使用・改変・再配布・fork していただけます。  
著作権表示とライセンス文を保持する限り、制限はほとんどありません。  
詳細は [LICENSE](LICENSE) ファイルをご覧ください。

